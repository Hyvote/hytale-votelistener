---
phase: 05-vote-streak-tracking
plan: 02
type: execute
depends_on: ["05-01"]
files_modified:
  - src/main/java/com/hyvote/votelistener/config/StreakBonus.java
  - src/main/java/com/hyvote/votelistener/config/Config.java
  - src/main/java/com/hyvote/votelistener/listener/VoteListener.java
  - src/main/java/com/hyvote/votelistener/util/PlaceholderProcessor.java
---

<objective>
Add streak bonus rewards configuration and integrate streak tracking into VoteListener.

Purpose: Allow server owners to configure bonus rewards for maintaining vote streaks, and track streaks on each vote.
Output: StreakBonus config model, streak placeholders, and VoteListener integration.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-vote-streak-tracking/05-01-SUMMARY.md

# Key files for this plan:
@src/main/java/com/hyvote/votelistener/config/Config.java
@src/main/java/com/hyvote/votelistener/config/RandomReward.java
@src/main/java/com/hyvote/votelistener/listener/VoteListener.java
@src/main/java/com/hyvote/votelistener/util/PlaceholderProcessor.java
@src/main/java/com/hyvote/votelistener/data/VoteDataManager.java
@src/main/java/com/hyvote/votelistener/data/PlayerVoteData.java

**Tech stack available:** gson-2.10.1
**Established patterns:** RandomReward config model pattern, PlaceholderProcessor with overloaded process() methods
**Constraining decisions:**
- Phase 03-02: PlaceholderProcessor uses method overloading for optional parameters
- Phase 04-02: Random rewards execute after guaranteed commands, reward commands use 3-arg process()
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create StreakBonus config model</name>
  <files>src/main/java/com/hyvote/votelistener/config/StreakBonus.java</files>
  <action>
Create StreakBonus class in config package following RandomReward pattern:
- int streakDays (number of consecutive days to trigger this bonus)
- String name (bonus tier name for logging/placeholders)
- List&lt;String&gt; commands (commands to execute when streak reached)

Include:
- Constructor with all fields
- Getter methods (getName(), getStreakDays(), getCommands())
- No setters - immutable after load

This allows config like: "at 7-day streak, give bonus X; at 30-day streak, give bonus Y"
  </action>
  <verify>mvn compile -q succeeds</verify>
  <done>StreakBonus.java exists with streakDays, name, commands fields and getters</done>
</task>

<task type="auto">
  <name>Task 2: Add streak configuration to Config</name>
  <files>src/main/java/com/hyvote/votelistener/config/Config.java</files>
  <action>
Add streak bonus configuration to Config class:
1. Add field: boolean streakBonusEnabled
2. Add field: List&lt;StreakBonus&gt; streakBonuses
3. In constructor, set defaults:
   - streakBonusEnabled = true
   - streakBonuses with example entries:
     * StreakBonus(3, "3-day", Arrays.asList("give %player% emerald 1"))
     * StreakBonus(7, "weekly", Arrays.asList("give %player% diamond 2", "say %player% has a %streak%-day vote streak!"))
     * StreakBonus(30, "monthly", Arrays.asList("give %player% diamond_block 1"))
4. Add getters: isStreakBonusEnabled(), getStreakBonuses()

Import Arrays, StreakBonus at top of file.
  </action>
  <verify>mvn compile -q succeeds</verify>
  <done>Config has streakBonusEnabled, streakBonuses list with defaults, getters work</done>
</task>

<task type="auto">
  <name>Task 3: Add streak placeholders and integrate into VoteListener</name>
  <files>src/main/java/com/hyvote/votelistener/util/PlaceholderProcessor.java, src/main/java/com/hyvote/votelistener/listener/VoteListener.java</files>
  <action>
**PlaceholderProcessor changes:**
Add new overload: process(String template, Vote vote, String rewardName, int streak, int totalVotes)
- Replace existing placeholders via existing logic
- Add %streak% -> streak value
- Add %totalvotes% -> totalVotes value
- Keep backward compatibility with existing 2-arg and 3-arg methods

**VoteListener changes:**
1. Add VoteDataManager field, update constructor to accept VoteDataManager
2. At start of onVote(), call voteDataManager.recordVote(vote.getUuid(), vote.getUsername())
3. Get returned PlayerVoteData for streak and totalVotes values
4. After random rewards section, add streak bonus section:
   - If config.isStreakBonusEnabled():
   - Find matching StreakBonus where player's currentStreak == streakBonus.getStreakDays()
   - If match found, log "Awarding streak bonus: {name}" and execute bonus commands
   - Use new 5-arg PlaceholderProcessor.process() for streak commands
5. Update existing command processing to use streak-aware placeholder processing
  </action>
  <verify>mvn compile -q succeeds</verify>
  <done>VoteListener records votes, calculates streaks, awards streak bonuses when thresholds reached</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `mvn compile -q` succeeds without errors
- [ ] StreakBonus.java exists in config package
- [ ] Config.java has streak fields with defaults
- [ ] VoteListener calls VoteDataManager.recordVote() on each vote
- [ ] Streak bonuses execute when player reaches configured streak days
- [ ] %streak% and %totalvotes% placeholders work in commands
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No compilation errors
- Phase 5: Vote Streak Tracking complete
</success_criteria>

<output>
After completion, create `.planning/phases/05-vote-streak-tracking/05-02-SUMMARY.md`
</output>
