---
phase: 03-configuration-system
plan: 02
type: execute
depends_on: ["03-01"]
files_modified: [src/main/java/com/hyvote/votelistener/util/PlaceholderProcessor.java, src/main/java/com/hyvote/votelistener/listener/VoteListener.java]
---

<objective>
Implement command placeholder replacement and integrate config-driven command execution.

Purpose: Replace placeholders (%player%, %service%, %uuid%) in configured commands with actual vote data.
Output: PlaceholderProcessor utility, VoteListener executing all configured commands with placeholder replacement.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-configuration-system/03-01-SUMMARY.md

**Prior context:**
- Config.java has commands list loaded from config.json
- ConfigManager provides getConfig() to access loaded config
- VoteListener currently has hardcoded "say" command
- Vote object provides: getUsername(), getServiceName(), getUuid() (from VoteEvent)

**Key files:**
@src/main/java/com/hyvote/votelistener/listener/VoteListener.java
@src/main/java/com/hyvote/votelistener/config/Config.java
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PlaceholderProcessor utility class</name>
  <files>src/main/java/com/hyvote/votelistener/util/PlaceholderProcessor.java</files>
  <action>
    1. Create util subpackage: com.hyvote.votelistener.util
    2. Create PlaceholderProcessor.java as a utility class (static methods)
    3. Implement process(String command, Vote vote): String method:
       - Replace %player% with vote.getUsername()
       - Replace %service% with vote.getServiceName()
       - Replace %uuid% with vote.getUuid() (if available, else empty string)
       - Replace %timestamp% with vote.getTimeStamp() (if available)
       - Return processed command string

    4. Use String.replace() for each placeholder - simple and reliable
    5. Handle null values gracefully (use empty string if any getter returns null)

    Keep it simple - no regex needed for fixed placeholders. Case-sensitive matching.
  </action>
  <verify>PlaceholderProcessor.process("give %player% diamond", vote) returns "give PlayerName diamond" when vote.getUsername() is "PlayerName".</verify>
  <done>PlaceholderProcessor processes all placeholders (%player%, %service%, %uuid%, %timestamp%) with null safety.</done>
</task>

<task type="auto">
  <name>Task 2: Integrate ConfigManager and PlaceholderProcessor into VoteListener</name>
  <files>src/main/java/com/hyvote/votelistener/listener/VoteListener.java, src/main/java/com/hyvote/votelistener/HytaleVoteListener.java</files>
  <action>
    1. Update VoteListener constructor:
       - Add Config parameter (or ConfigManager reference)
       - Store reference for accessing command list

    2. Update HytaleVoteListener.start():
       - Pass config to VoteListener: new VoteListener(getServer(), getLogger(), configManager.getConfig())

    3. Update VoteListener.onVote() method:
       - Remove hardcoded "say" command
       - Get command list from config.getCommands()
       - For each command in list:
         a. Process placeholders: PlaceholderProcessor.process(command, vote)
         b. Execute command: server.executeCommand(processedCommand)
         c. Log at debug level if config.isDebugMode()

    4. Handle broadcastVote setting:
       - If config.isBroadcastVote() is true, add broadcast after executing commands
       - Use: server.executeCommand("say " + username + " voted on " + serviceName + "!")

    5. Add import for PlaceholderProcessor and Config
  </action>
  <verify>When a vote is received, all commands from config.json are executed with placeholders replaced by actual vote data.</verify>
  <done>VoteListener executes configured commands with placeholder replacement. No hardcoded commands remain.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] PlaceholderProcessor handles all placeholders (%player%, %service%, %uuid%, %timestamp%)
- [ ] VoteListener receives Config via constructor
- [ ] onVote() iterates config.getCommands() and executes each
- [ ] Placeholders are replaced before command execution
- [ ] broadcastVote setting controls vote announcement
- [ ] No compilation errors
</verification>

<success_criteria>

- All tasks completed
- PlaceholderProcessor correctly replaces all placeholders
- VoteListener uses config-driven command execution
- Vote rewards are fully configurable via config.json
- Phase 3 complete - configuration system functional
</success_criteria>

<output>
After completion, create `.planning/phases/03-configuration-system/03-02-SUMMARY.md` following summary.md template.

Include "Phase 3 complete" in Next Phase Readiness section.
</output>
