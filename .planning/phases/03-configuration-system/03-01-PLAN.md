---
phase: 03-configuration-system
plan: 01
type: execute
depends_on: []
files_modified: [pom.xml, src/main/java/com/hyvote/votelistener/config/Config.java, src/main/java/com/hyvote/votelistener/config/ConfigManager.java, src/main/java/com/hyvote/votelistener/HytaleVoteListener.java]
---

<objective>
Create JSON configuration system with file loading and default generation.

Purpose: Enable server admins to configure reward commands without code changes.
Output: Config.java model, ConfigManager.java for load/save, default config.json generated on first run.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-vote-event-listener/02-01-SUMMARY.md

**Prior context:**
- Plugin lifecycle in place (setup, start, shutdown)
- VoteListener exists with hardcoded "say" command
- Config loading should happen in setup() method (from 01-02-SUMMARY)
- JSON format required (match Hytale ecosystem conventions)

**Key files:**
@src/main/java/com/hyvote/votelistener/HytaleVoteListener.java
@pom.xml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Gson dependency and create Config model class</name>
  <files>pom.xml, src/main/java/com/hyvote/votelistener/config/Config.java</files>
  <action>
    1. Add Gson 2.10.1 dependency to pom.xml (Google's JSON library - standard for Java JSON parsing)
    2. Create config subpackage: com.hyvote.votelistener.config
    3. Create Config.java with fields:
       - commands: List<String> - commands to execute on vote (e.g., "give %player% diamond 1")
       - broadcastVote: boolean - whether to announce votes to server (default true)
       - debugMode: boolean - enable verbose logging (default false)
    4. Add getter methods for all fields
    5. Add default constructor that initializes with sensible defaults

    Use Gson annotations if needed for JSON field mapping. Keep the config simple - this is v1.
  </action>
  <verify>Config.java compiles with all fields and getters. pom.xml has Gson dependency.</verify>
  <done>Config model class exists with commands list, broadcastVote, and debugMode fields. Gson dependency added.</done>
</task>

<task type="auto">
  <name>Task 2: Create ConfigManager with load/save and integrate into plugin lifecycle</name>
  <files>src/main/java/com/hyvote/votelistener/config/ConfigManager.java, src/main/java/com/hyvote/votelistener/HytaleVoteListener.java</files>
  <action>
    1. Create ConfigManager.java in config subpackage with:
       - Constructor taking Path pluginDataFolder and Logger
       - loadConfig(): Config - loads config.json from data folder, returns Config object
       - saveDefaultConfig(): void - writes default config.json if not exists
       - getConfig(): Config - returns loaded config (call after loadConfig)

    2. loadConfig() implementation:
       - Check if config.json exists in pluginDataFolder
       - If not exists: call saveDefaultConfig(), then load
       - Use Gson to parse JSON file into Config object
       - Log info message about loading config

    3. saveDefaultConfig() implementation:
       - Create pluginDataFolder directory if not exists
       - Create new Config() with defaults
       - Use Gson with setPrettyPrinting() to write JSON
       - Default commands: ["say %player% voted on %service%!", "give %player% diamond 1"]

    4. Integrate into HytaleVoteListener:
       - Add private ConfigManager configManager field
       - In setup(): create ConfigManager, call loadConfig()
       - Add getConfigManager() getter for other components to access

    Note: Use getDataFolder() from PluginBase to get plugin's data directory (plugins/HytaleVoteListener/).
    If getDataFolder() doesn't exist on PluginBase, use Path.of("plugins", getName()) as fallback.
  </action>
  <verify>Plugin creates plugins/HytaleVoteListener/config.json with default values on first load. Subsequent loads parse existing config.</verify>
  <done>ConfigManager loads/saves JSON config. Default config.json generated with example commands. Plugin setup() initializes ConfigManager.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Config.java has commands list, broadcastVote, debugMode fields with getters
- [ ] ConfigManager.java has loadConfig(), saveDefaultConfig(), getConfig() methods
- [ ] HytaleVoteListener.setup() creates and loads ConfigManager
- [ ] Default config.json structure is valid JSON with example commands
- [ ] No compilation errors (check with IDE or review imports)
</verification>

<success_criteria>

- All tasks completed
- Config model class represents JSON structure
- ConfigManager handles file I/O with Gson
- Plugin integrates ConfigManager in setup() lifecycle
- Default config has example vote reward commands
</success_criteria>

<output>
After completion, create `.planning/phases/03-configuration-system/03-01-SUMMARY.md` following summary.md template.
</output>
