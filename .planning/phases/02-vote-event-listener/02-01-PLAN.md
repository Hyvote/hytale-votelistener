---
phase: 02-vote-event-listener
plan: 01
type: execute
depends_on: []
files_modified: [pom.xml, src/main/java/com/hyvote/votelistener/HytaleVoteListener.java, src/main/java/com/hyvote/votelistener/listener/VoteListener.java]
---

<objective>
Subscribe to VoteEvent from HytaleVotifier and execute a basic test command when a vote is received.

Purpose: Establish the core vote handling pipeline that all reward features will build upon.
Output: Working vote listener that logs vote details and executes a test command.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-vote-event-listener/DISCOVERY.md
@.planning/phases/01-foundation/01-02-SUMMARY.md
@src/main/java/com/hyvote/votelistener/HytaleVoteListener.java
@pom.xml

**From Phase 1:**
- Plugin skeleton exists with setup(), start(), shutdown() lifecycle
- Package: com.hyvote.votelistener
- HytaleVotifier declared as dependency in manifest.json

**From Discovery:**
- VoteEvent expected from com.hyvote.votifier.event package
- EventBus subscription via getServer().getEventBus() or similar
- Vote contains: username, serviceName, address, timestamp
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add HytaleVotifier as Maven dependency</name>
  <files>pom.xml</files>
  <action>
Add HytaleVotifier as a system-scope dependency in pom.xml, similar to HytaleServer.jar:

```xml
<dependency>
    <groupId>com.hyvote</groupId>
    <artifactId>hytale-votifier</artifactId>
    <version>1.0.0</version>
    <scope>system</scope>
    <systemPath>${project.basedir}/HytaleVotifier.jar</systemPath>
</dependency>
```

Place after the HytaleServer dependency. This provides compile-time access to VoteEvent and Vote classes.

Note: The JAR file must exist at project root for compilation. If not present, create a placeholder note but proceed with code implementation.
  </action>
  <verify>pom.xml contains HytaleVotifier dependency with system scope</verify>
  <done>pom.xml updated with HytaleVotifier dependency</done>
</task>

<task type="auto">
  <name>Task 2: Create VoteListener class with event handling</name>
  <files>src/main/java/com/hyvote/votelistener/listener/VoteListener.java</files>
  <action>
Create a new class VoteListener in the listener subpackage:

```java
package com.hyvote.votelistener.listener;

import com.hyvote.votifier.event.VoteEvent;
import com.hyvote.votifier.Vote;
import com.hypixel.hytale.server.core.Server;
import java.util.logging.Logger;

public class VoteListener {
    private final Server server;
    private final Logger logger;

    public VoteListener(Server server, Logger logger) {
        this.server = server;
        this.logger = logger;
    }

    public void onVote(VoteEvent event) {
        Vote vote = event.getVote();
        String username = vote.getUsername();
        String serviceName = vote.getServiceName();

        logger.info("Vote received from " + serviceName + " for player: " + username);

        // Execute test command - broadcasts message to server
        String command = "say " + username + " voted on " + serviceName + "!";
        server.executeCommand(command); // May need adjustment based on actual API
    }
}
```

**API assumptions to validate at runtime:**
- VoteEvent.getVote() returns Vote object
- Vote has getUsername() and getServiceName()
- Server has executeCommand(String) method

If APIs differ, adjust during execution. The pattern will remain the same.
  </action>
  <verify>VoteListener.java exists in src/main/java/com/hyvote/votelistener/listener/ with onVote method</verify>
  <done>VoteListener class created with vote handling method</done>
</task>

<task type="auto">
  <name>Task 3: Register VoteListener in plugin lifecycle</name>
  <files>src/main/java/com/hyvote/votelistener/HytaleVoteListener.java</files>
  <action>
Modify HytaleVoteListener to:

1. Add import for VoteListener and VoteEvent
2. Add private field for VoteListener instance
3. In start(): Create VoteListener and register with event bus
4. In shutdown(): Unsubscribe from event bus (if supported)

```java
// Add to imports
import com.hyvote.votelistener.listener.VoteListener;
import com.hyvote.votifier.event.VoteEvent;

// Add field
private VoteListener voteListener;

// In start() - after the version log
voteListener = new VoteListener(getServer(), getLogger());
getServer().getEventBus().subscribe(VoteEvent.class, voteListener::onVote);
getLogger().info("Registered vote event listener");

// In shutdown() - before disabled log
if (voteListener != null) {
    // Unsubscribe if API supports it
    getLogger().info("Unregistered vote event listener");
}
```

**API uncertainties:**
- getServer() should work from PluginBase
- getEventBus() may be named differently
- Unsubscribe pattern may vary - log but don't fail if unsupported
  </action>
  <verify>HytaleVoteListener.java registers VoteListener in start() and logs registration</verify>
  <done>Plugin registers vote listener on start and unregisters on shutdown</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] pom.xml includes HytaleVotifier dependency
- [ ] VoteListener.java exists with onVote method
- [ ] HytaleVoteListener.java registers listener in start()
- [ ] Code compiles without syntax errors (manual review - Maven not installed)
- [ ] All files follow existing code conventions (package names, imports, formatting)
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Vote listener pipeline established
- Ready for Phase 3 (Configuration) to add configurable commands
  </success_criteria>

<output>
After completion, create `.planning/phases/02-vote-event-listener/02-01-SUMMARY.md`:

# Phase 2: Vote Event Listener - Plan 01 Summary

**[Substantive one-liner - what shipped]**

## Accomplishments
- [Key outcomes]

## Files Created/Modified
- [File list with descriptions]

## Decisions Made
- [API decisions based on implementation]

## Issues Encountered
- [Any API mismatches or adjustments needed]

## Next Phase Readiness
- Phase 3 (Configuration) can replace hardcoded "say" command with configurable commands
- Vote data (username, serviceName) available for placeholder replacement
</output>
