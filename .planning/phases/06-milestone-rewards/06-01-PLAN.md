---
phase: 06-milestone-rewards
plan: 01
type: execute
depends_on: []
files_modified:
  - src/main/java/com/hyvote/votelistener/config/MilestoneBonus.java
  - src/main/java/com/hyvote/votelistener/config/Config.java
  - src/main/java/com/hyvote/votelistener/listener/VoteListener.java
---

<objective>
Implement milestone rewards - bonus rewards triggered when players reach configurable total vote counts.

Purpose: Add cumulative vote tracking incentives (every N votes) complementing the existing streak bonus system.
Output: Working milestone detection in VoteListener with MilestoneBonus config model.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md

**Prior phase providing totalVotes tracking:**
@.planning/phases/05-vote-streak-tracking/05-01-SUMMARY.md

**Existing patterns to follow:**
@src/main/java/com/hyvote/votelistener/config/StreakBonus.java
@src/main/java/com/hyvote/votelistener/config/Config.java
@src/main/java/com/hyvote/votelistener/listener/VoteListener.java

**Tech stack available:** GSON for JSON serialization (already shaded)
**Established patterns:** Config model classes (StreakBonus pattern), VoteListener bonus execution pattern
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create MilestoneBonus config model and add to Config</name>
  <files>
    src/main/java/com/hyvote/votelistener/config/MilestoneBonus.java,
    src/main/java/com/hyvote/votelistener/config/Config.java
  </files>
  <action>
Create MilestoneBonus.java following the exact StreakBonus.java pattern:
- Fields: votesRequired (int), name (String), commands (List<String>)
- Default constructor for Gson deserialization
- Full constructor with all fields
- Getters for all fields (no setters - immutable after load)
- Javadoc with example JSON configuration

Update Config.java:
- Add field: milestoneBonusEnabled (boolean)
- Add field: milestoneBonuses (List<MilestoneBonus>)
- In constructor: initialize milestoneBonusEnabled = true
- In constructor: initialize milestoneBonuses with default entries:
  - 10 votes: "first-ten", give %player% emerald 3
  - 50 votes: "fifty", give %player% diamond 3
  - 100 votes: "century", give %player% diamond_block 1, say %player% reached %totalvotes% total votes!
- Add getter: isMilestoneBonusEnabled()
- Add getter: getMilestoneBonuses()

Follow existing code style: package structure, Javadoc format, import ordering.
  </action>
  <verify>
mvn compile -q succeeds with no errors
  </verify>
  <done>
MilestoneBonus.java exists with votesRequired/name/commands fields. Config.java has milestoneBonusEnabled and milestoneBonuses fields with defaults and getters.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add milestone detection to VoteListener</name>
  <files>src/main/java/com/hyvote/votelistener/listener/VoteListener.java</files>
  <action>
In onVote() method, after the streak bonus section (around line 107) and before the broadcast section:

Add milestone bonus check following the exact streak bonus pattern:
```java
// Execute milestone bonus rewards if enabled
if (config.isMilestoneBonusEnabled()) {
    for (MilestoneBonus milestoneBonus : config.getMilestoneBonuses()) {
        if (totalVotes == milestoneBonus.getVotesRequired()) {
            logger.info("Awarding milestone bonus: " + milestoneBonus.getName());

            for (String bonusCommand : milestoneBonus.getCommands()) {
                String processedBonusCommand = PlaceholderProcessor.process(
                    bonusCommand, vote, milestoneBonus.getName(), currentStreak, totalVotes);
                server.executeCommand(processedBonusCommand);

                if (config.isDebugMode()) {
                    logger.info("[Debug] Executed milestone bonus command: " + processedBonusCommand);
                }
            }
            break; // Only award one milestone bonus per vote
        }
    }
}
```

Add import for MilestoneBonus at top of file.

Note: Only one milestone bonus triggers per vote (first match wins via break), matching the streak bonus behavior.
  </action>
  <verify>
mvn compile -q succeeds with no errors
  </verify>
  <done>
VoteListener imports MilestoneBonus, checks totalVotes against configured milestones, executes bonus commands when milestone reached.
  </done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `mvn compile` succeeds without errors
- [ ] MilestoneBonus.java exists with correct structure
- [ ] Config.java has milestoneBonusEnabled field and default milestones
- [ ] VoteListener.java checks milestones and executes bonus commands
- [ ] Code follows existing patterns (StreakBonus, streak bonus execution)
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No compilation errors or warnings
- Milestone detection integrated into vote flow
- Phase 6 complete
</success_criteria>

<output>
After completion, create `.planning/phases/06-milestone-rewards/06-01-SUMMARY.md`
</output>
