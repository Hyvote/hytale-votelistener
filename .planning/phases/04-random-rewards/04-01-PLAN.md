---
phase: 04-random-rewards
plan: 01
type: execute
depends_on: []
files_modified:
  - src/main/java/com/hyvote/votelistener/config/RandomReward.java
  - src/main/java/com/hyvote/votelistener/config/Config.java
  - src/main/java/com/hyvote/votelistener/reward/RewardSelector.java
---

<objective>
Add random reward configuration model and weighted selection algorithm.

Purpose: Enable configurable random rewards with weighted chances that can be selected when a player votes.
Output: RandomReward config model, updated Config class with rewards list, RewardSelector utility for weighted random selection.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-configuration-system/03-02-SUMMARY.md

**Key files:**
@src/main/java/com/hyvote/votelistener/config/Config.java
@src/main/java/com/hyvote/votelistener/util/PlaceholderProcessor.java

**Tech stack available:** GSON 2.10.1 (shaded), Java 25, Maven
**Established patterns:** Config model with defaults, utility classes in util subpackage, GSON for JSON serialization
**Constraining decisions:** JSON config format, PlaceholderProcessor for command replacement
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create RandomReward configuration model</name>
  <files>src/main/java/com/hyvote/votelistener/config/RandomReward.java</files>
  <action>
Create RandomReward class in config package with fields:
- name (String) - identifier for the reward tier (e.g., "common", "rare", "legendary")
- chance (double) - weight value for selection probability (higher = more likely)
- commands (List<String>) - commands to execute when this reward is selected

Add constructor with defaults, getters for all fields. Follow same Javadoc style as Config.java.
Do NOT add setters - config is immutable once loaded.
  </action>
  <verify>File exists with correct package, fields, constructor, and getters</verify>
  <done>RandomReward.java compiles with name, chance, commands fields and getters</done>
</task>

<task type="auto">
  <name>Task 2: Add random rewards to Config model</name>
  <files>src/main/java/com/hyvote/votelistener/config/Config.java</files>
  <action>
Add to Config class:
- private List<RandomReward> randomRewards field
- Initialize with example rewards in constructor:
  - "common" (chance: 70.0) with commands: ["give %player% iron_ingot 5"]
  - "rare" (chance: 25.0) with commands: ["give %player% gold_ingot 3"]
  - "legendary" (chance: 5.0) with commands: ["give %player% diamond 1", "say %player% got a legendary reward!"]
- Add getter: getRandomRewards()
- Add boolean field: randomRewardsEnabled (default true)
- Add getter: isRandomRewardsEnabled()

Keep existing commands field - it's for guaranteed rewards on every vote. Random rewards are additional.
  </action>
  <verify>Config has randomRewards list with 3 example tiers, getRandomRewards() returns list</verify>
  <done>Config.java has randomRewards field with example data and getter method</done>
</task>

<task type="auto">
  <name>Task 3: Create RewardSelector utility class</name>
  <files>src/main/java/com/hyvote/votelistener/reward/RewardSelector.java</files>
  <action>
Create RewardSelector class in new reward subpackage with:
- private static final Random random = new Random()
- public static RandomReward select(List<RandomReward> rewards) method

Selection algorithm (weighted random):
1. Sum all chance values to get totalWeight
2. Generate random double from 0 to totalWeight
3. Iterate rewards, accumulating weights until accumulated >= random value
4. Return the reward where threshold was crossed

Handle edge cases:
- Empty list: return null
- Single item: return it directly
- All zero chances: return first item (avoid infinite loop)

Add Javadoc explaining the weighted selection algorithm.
  </action>
  <verify>RewardSelector.select() returns rewards with probability proportional to their chance values</verify>
  <done>RewardSelector.java exists with weighted random selection algorithm</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] RandomReward.java exists in config package with name, chance, commands
- [ ] Config.java has randomRewards list with 3 example tiers
- [ ] RewardSelector.java exists in reward package with select() method
- [ ] All classes have proper Javadoc matching existing style
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Random reward configuration model ready for VoteListener integration
- Selection algorithm handles weighted probabilities correctly
</success_criteria>

<output>
After completion, create `.planning/phases/04-random-rewards/04-01-SUMMARY.md`
</output>
